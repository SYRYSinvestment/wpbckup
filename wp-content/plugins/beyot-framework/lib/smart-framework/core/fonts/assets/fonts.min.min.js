var GSF_Fonts=GSF_Fonts||{};(function(o){"use strict";GSF_Fonts={_loadFontCount:0,_fonts:{},_isSubmitting:false,init:function(){this.tabClick();this.binderFonts();this.searchFonts();this.events()},events:function(){o(".gsf-reset-active-fonts").on("click",function(t){t.preventDefault();if(!confirm(GSF_META_DATA.msgConfirmResetFont)){return}if(GSF_Fonts._isSubmitting){return}GSF_Fonts._isSubmitting=true;var n=o(this);n.find("i").addClass("fa-spin fa-spinner");o.ajax({url:GSF_META_DATA.ajaxUrl,data:{action:"gsf_reset_active_font",_nonce:GSF_META_DATA.nonce},type:"post",success:function(t){n.find("i").removeClass("fa-spin fa-spinner");GSF_Fonts._isSubmitting=false;if(t.success){GSF_Fonts.bindActiveFont()}else{alert(t.data)}},error:function(){n.find("i").removeClass("fa-spin fa-spinner");GSF_Fonts._isSubmitting=false}})})},binderFonts:function(){var t=["google","standard","custom"];for(var n in t){this.bindFonts(t[n])}this.bindActiveFont()},getFontFamily:function(t){if(t.indexOf(",")!=-1){return t}if(t.indexOf(" ")!=-1){return"'"+t+"'"}return t},enqueueFont:function(t){var n="";switch(t.kind){case"webfonts#webfont":{n="https://fonts.googleapis.com/css?family="+t.family.replace(" ","+")+":100,200,300,400,500,600,700,800,900,1000";break}case"custom":{n=typeof t.css_url!=="undefined"?t.css_url:GSF_META_DATA.font_url+t.css_file;break}}if(n!==""){o("body").append('<link class="gsf-preview-css-font" rel="stylesheet" href="'+n+'" type="text/css" media="all" />')}},bindFonts:function(e,a){if(a==null){a=false}var t=o(".gsf-fonts-wrapper").data("nonce");o.ajax({url:GSF_META_DATA.ajaxUrl,data:{action:"gsf_get_font_list",_nonce:GSF_META_DATA.nonce,font_type:e},type:"get",success:function(t){if(!t.success){return}GSF_Fonts._fonts[t.data.font_type]=t.data.fonts.items;var n;switch(t.data.font_type){case"google":{n=wp.template("gsf-google-fonts");break}case"standard":{n=wp.template("gsf-standard-fonts");break}case"custom":{n=wp.template("gsf-custom-fonts");break}}if(n){var i=o(".gsf-font-listing-inner"),s=o(n(t.data));o("#"+e+"_fonts").remove();i.append(s);GSF_Fonts.addEventListener(s);s.find(".gsf-font-categories li a").first().trigger("click");if(a){s.show()}}GSF_Fonts._loadFontCount++},error:function(){GSF_Fonts._loadFontCount++}})},addEventListener:function(i){i.find("form").ajaxForm({beforeSubmit:function(){if(GSF_Fonts._isSubmitting){return false}i.find("form").find("button i").addClass("fa-spin fa-spinner");GSF_Fonts._isSubmitting=true},success:function(t){i.find("form").find("button i").removeClass("fa-spin fa-spinner");GSF_Fonts._isSubmitting=false;if(t.success){GSF_Fonts.bindFonts("custom",true);o("#gsf-custom-font-popup").find(".mfp-close").trigger("click")}else{alert(t.data)}}});i.find(".gsf-font-categories li a").on("click",function(){var t=o(this),n=t.parent().data("ref");i.find(".gsf-font-categories li").removeClass("active");t.parent().addClass("active");GSF_Fonts.filterFontsByCate(i,n);o("#search_fonts").val("")});i.find(".gsf-add-custom-font button").on("click",function(){o.magnificPopup.open({items:{src:"#gsf-custom-font-popup",type:"inline"},mainClass:"mfp-move-horizontal",callbacks:{open:function(){this.content.find("form")[0].reset()}},openDelay:0,removalDelay:100,midClick:true})});i.find(".gsf-font-item-action-delete").on("click",function(t){t.preventDefault();if(!confirm(GSF_META_DATA.msgConfirmDeleteCustomFont)){return}if(GSF_Fonts._isSubmitting){return}GSF_Fonts._isSubmitting=true;var n=o(this),i=n.closest(".gsf-font-item").data("name");n.find("i").addClass("fa-spin fa-spinner");o.ajax({url:GSF_META_DATA.ajaxUrl,data:{action:"gsf_delete_custom_font",_nonce:GSF_META_DATA.nonce,family_name:i},type:"post",success:function(t){n.find("i").removeClass("fa-spin fa-spinner");GSF_Fonts._isSubmitting=false;if(t.success){GSF_Fonts.bindFonts("custom",true)}else{alert(t.data)}},error:function(){n.find("i").removeClass("fa-spin fa-spinner");GSF_Fonts._isSubmitting=false}})});i.find(".gsf-font-item-action-add").on("click",function(t){t.preventDefault();var n=o(this),i=n.data("type"),s=n.closest(".gsf-font-item").data("name"),e=GSF_Fonts.findFontSource(GSF_Fonts._fonts[i],s);if(e==null){return}if(n.find("i").hasClass("fa-check")){return}if(GSF_Fonts._isSubmitting){return true}GSF_Fonts._isSubmitting=true;n.find("i").addClass("fa-spin fa-spinner");o.ajax({url:GSF_META_DATA.ajaxUrl,data:{action:"gsf_using_font",_nonce:GSF_META_DATA.nonce,font_data:e},type:"post",success:function(t){GSF_Fonts._isSubmitting=false;n.find("i").removeClass("fa-spin fa-spinner");if(t.success){n.find("i").attr("class","fa fa-check");GSF_Fonts.bindActiveFont()}else{alert(t.data)}},error:function(){GSF_Fonts._isSubmitting=false;n.find("i").removeClass("fa-spin fa-spinner")}})})},bindActiveFont:function(){var t=o(".gsf-fonts-wrapper").data("nonce");o.ajax({url:GSF_META_DATA.ajaxUrl,data:{action:"gsf_get_font_list",_nonce:GSF_META_DATA.nonce,font_type:"active"},type:"get",success:function(t){if(!t.success){return}GSF_Fonts._fonts[t.data.font_type]=t.data.fonts.items;var n=wp.template("gsf-active-fonts");if(n){var i=o(".gsf-font-active-listing"),s=o(n(t.data));o("#active_fonts").remove();i.append(s);GSF_Fonts.activeFontAddEventListener(s);o(".gsf-preview-css-font").remove();for(var e in t.data.fonts.items){GSF_Fonts.enqueueFont(t.data.fonts.items[e])}}},error:function(){}})},activeFontAddEventListener:function(n){n.find(".gsf-font-active-item-header").on("click",function(t){if(o(t.target).closest(".gsf-font-active-item-remove").length){return}o(this).toggleClass("in");o(this).next(".gsf-font-active-content").slideToggle()});n.find(".gsf-font-active-item-remove").on("click",function(t){t.preventDefault();if(!confirm(GSF_META_DATA.msgConfirmRemoveActiveFont)){return}var n=o(this),i=n.closest(".gsf-font-active-item"),s=i.data("name");if(GSF_Fonts._isSubmitting){return true}GSF_Fonts._isSubmitting=true;n.find("i").addClass("fa-spin fa-spinner");o.ajax({url:GSF_META_DATA.ajaxUrl,data:{action:"gsf_remove_active_font",_nonce:GSF_META_DATA.nonce,family_name:s},type:"post",success:function(t){GSF_Fonts._isSubmitting=false;n.find("i").removeClass("fa-spin fa-spinner");if(t.success){o('.gsf-font-item[data-name="'+t.data.family+'"]').find(".gsf-font-item-action-add i").attr("class","fa fa-plus");GSF_Fonts.bindActiveFont()}else{alert(t.data)}},error:function(){GSF_Fonts._isSubmitting=false;n.find("i").removeClass("fa-spin fa-spinner")}})});n.find("form").ajaxForm({beforeSubmit:function(){if(GSF_Fonts._isSubmitting){return false}n.find("form").find("button i").addClass("fa-spin fa-spinner");GSF_Fonts._isSubmitting=true},success:function(t){n.find("form").find("button i").removeClass("fa-spin fa-spinner");GSF_Fonts._isSubmitting=false;if(!t.success){alert(t.data)}}})},findFontSource:function(t,n){for(var i in t){if(t[i].family==n){return t[i]}}return null},filterFontsByCate:function(t,n){var i=t.find(".gsf-font-item");i.each(function(){var t=o(this);if(t.data("category")!==n){t.hide()}else{t.show()}})},filterFontByKeyWord:function(t,i){var n=t.find(".gsf-font-item");n.each(function(){var t=o(this),n=t.find(".gsf-font-item-name").text();try{if(n.search(new RegExp(i,"i"))<0){t.hide()}else{t.show()}}catch(t){}})},searchFonts:function(){o("#search_fonts").on("keyup",function(t){var n=o(".gsf-font-container:visible"),i=o(this).val();n.find(".gsf-font-categories li").removeClass("active");GSF_Fonts.filterFontByKeyWord(n,i)})},tabClick:function(){o(".gsf-font-type > li > a").on("click",function(t){t.preventDefault();if(GSF_Fonts._loadFontCount<3){return}var n=o(this);if(n.parent().hasClass("active")){return}var i=o(this).data("ref");o(".gsf-font-type > li").removeClass("active");n.parent().addClass("active");o(".gsf-font-container").each(function(){var t=o(this);if(t.data("ref")!=i){t.slideUp()}});o("#"+i+"_fonts").slideDown(function(){if(o("#"+i+"_fonts").find(".gsf-font-categories li a").length){o("#"+i+"_fonts").find(".gsf-font-categories li a").first().trigger("click")}else{o("#search_fonts").val("");o("#search_fonts").trigger("keyup")}})})}};o(document).ready(function(){GSF_Fonts.init()})})(jQuery);